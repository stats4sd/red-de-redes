ifelse(selected_variable_type=="sensacion_termica", "max_sensacion_termica,min_sensacion_termica,avg_sensacion_termica",
ifelse(selected_variable_type=="lluvia_24_horas_total","lluvia_24_horas_total",NA)))))))))
selected_variables <- as.vector(strsplit(selected_variables, ",")[[1]])
test <- data  %>% select(all_of(selected_variables))
library(dotenv)
library(RMySQL)
library(tidyverse)
library(writexl)
selected_station <- 2
selected_start_year <- 2006
selected_end_year <- 2009
selected_variable <- "max_temperatura_interna"
dotenv::load_dot_env("../../.env")
con <- dbConnect(RMySQL::MySQL(),
dbname = Sys.getenv("DB_DATABASE"),
host = Sys.getenv("DB_HOST"),
port = as.integer(Sys.getenv("DB_PORT")),
user = Sys.getenv("DB_USERNAME"),
password = Sys.getenv("DB_PASSWORD")
)
stations_table <- tbl(con, "stations") %>%
select(1,3) %>%
collect()
Encoding(stations_table$label) <- "UTF-8"
View(stations_table)
selected_station_label <- as.character(
stations_table %>%
filter(id==selected_station) %>%
select(2)
)
monthly_met_data_table <- tbl(con, "monthly_met_data")
data <- monthly_met_data_table %>%
mutate(
month = substring(as.character(year_and_month), 1, 4),
year = substring(as.character(year_and_month), 5, 6)
) %>%
filter(station_id == selected_station & year >= selected_start_year & year <= selected_end_year) %>%
select(month, year, selected_variable) %>%
collect()
View(data)
data <- monthly_met_data_table
data <- monthly_met_data_table %>% collect()
View(data)
data_original <- monthly_met_data_table %>% collect()
View(data_original)
data <- monthly_met_data_table %>%
mutate(
month = substring(as.character(year_and_month), 1, 4),
year = substring(as.character(year_and_month), 5, 6)
) %>%
#filter(station_id == selected_station & year >= selected_start_year & year <= selected_end_year) %>%
#select(month, year, selected_variable) %>%
collect()
View(data)
class(selected_end_year)
data <- monthly_met_data_table %>%
mutate(
month = substring(as.character(year_and_month), 1, 4),
year = substring(as.character(year_and_month), 5, 6)
) %>%
filter(station_id == selected_station & year >= selected_start_year & year <= selected_end_year) %>%
select(month, year, selected_variable) %>%
collect()
View(data)
data <- monthly_met_data_table %>%
mutate(
month = as.numeric(substring(as.character(year_and_month), 1, 4)),
year = as.numeric(substring(as.character(year_and_month), 5, 6))
) %>%
filter(station_id == selected_station & year >= selected_start_year & year <= selected_end_year) %>%
select(month, year, selected_variable) %>%
collect()
data <- monthly_met_data_table %>%
mutate(
month = substring(as.character(year_and_month), 1, 4),
year = substring(as.character(year_and_month), 5, 6)
) %>%
#filter(station_id == selected_station & year >= selected_start_year & year <= selected_end_year) %>%
select(month, year, selected_variable) %>%
collect()
View(data)
senamhi_monthly <- data %>%
arrange(month) %>%
mutate(month = as.integer(month)) %>%
complete(month = 1:12) %>%
pivot_wider(names_from = "month", values_from = 3) %>%
rename(
"AÃ‘O" = year, ENE = `1`, FEB = `2`, MAR = `3`, ABR = `4`, MAY = `5`, JUN = `6`,
JUL = `7`, AGO = `8`, SEP = `9`, OCT = `10`, NOV = `11`, DIC = `12`
)
View(senamhi_monthly)
data <- monthly_met_data_table %>%
mutate(
month = substring(as.character(year_and_month), 1, 4),
year = substring(as.character(year_and_month), 5, 6)
) %>%
#filter(station_id == selected_station & year >= selected_start_year & year <= selected_end_year) %>%
select(month, year, selected_variable) %>%
collect()
data <- monthly_met_data_table %>%
mutate(
month = substring(as.character(year_and_month), 1, 4),
year = substring(as.character(year_and_month), 5, 6)
) %>%
#filter(station_id == selected_station & year >= selected_start_year & year <= selected_end_year) %>%
#select(month, year, selected_variable) %>%
collect()
data <- monthly_met_data_table %>%
mutate(
month = substring(as.character(year_and_month), 1, 4),
year = substring(as.character(year_and_month), 5, 6)
) %>%
#filter(station_id == selected_station & year >= selected_start_year & year <= selected_end_year) %>%
select(month, year, selected_variable) %>%
collect()
data <- monthly_met_data_table %>%
mutate(
month = as.numeric(substring(as.character(year_and_month), 1, 4)),
year = as.numeric(substring(as.character(year_and_month), 5, 6))
) %>%
#filter(station_id == selected_station & year >= selected_start_year & year <= selected_end_year) %>%
select(month, year, selected_variable) %>%
collect()
data <- monthly_met_data_table %>%
mutate(
month = as.numeric(substring(as.character(year_and_month), 1, 4)),
year = as.numeric(substring(as.character(year_and_month), 5, 6))
) %>%
show_query()
data <- monthly_met_data_table %>%
mutate(
month = as.numeric(substring(as.character(year_and_month), 1, 4)),
year = as.numeric(substring(as.character(year_and_month), 5, 6))
) %>%
#show_query()
#filter(station_id == selected_station & year >= selected_start_year & year <= selected_end_year) %>%
select(month, year, selected_variable) %>%
collect()
data <- monthly_met_data_table %>%
mutate(
month = as.integer(substring(as.character(year_and_month), 1, 4)),
year = as.numeric(substring(as.character(year_and_month), 5, 6))
) %>%
#show_query()
#filter(station_id == selected_station & year >= selected_start_year & year <= selected_end_year) %>%
select(month, year, selected_variable) %>%
collect()
data <- monthly_met_data_table %>%
mutate(
month = sql(CAST(SUBSTR(CAST(`year_and_month` AS CHAR), 1, 4) AS INT))
#month = as.integer(substring(as.character(year_and_month), 1, 4)),
#year = as.numeric(substring(as.character(year_and_month), 5, 6))
) %>%
#show_query()
#filter(station_id == selected_station & year >= selected_start_year & year <= selected_end_year) %>%
select(month, year, selected_variable) %>%
collect()
data <- monthly_met_data_table %>%
mutate(
month = sql(CAST(SUBSTR(CAST(`year_and_month` AS CHAR), 1, 4) AS INT))
#month = as.integer(substring(as.character(year_and_month), 1, 4)),
#year = as.numeric(substring(as.character(year_and_month), 5, 6))
) %>%
#show_query()
#filter(station_id == selected_station & year >= selected_start_year & year <= selected_end_year) %>%
select(month, year, selected_variable) %>%
collect()
data <- monthly_met_data_table %>%
mutate(
month = sql(CAST(SUBSTR(CAST(`year_and_month` AS CHAR), 1, 4) AS INT) AS `month`)
#month = as.integer(substring(as.character(year_and_month), 1, 4)),
#year = as.numeric(substring(as.character(year_and_month), 5, 6))
) %>%
#show_query()
#filter(station_id == selected_station & year >= selected_start_year & year <= selected_end_year) %>%
select(month, year, selected_variable) %>%
collect()
data <- monthly_met_data_table %>%
mutate(
month = sql(CAST(SUBSTR(CAST(`year_and_month` AS CHAR), 1, 4) AS INT) AS `month`)
#month = as.integer(substring(as.character(year_and_month), 1, 4)),
#year = as.numeric(substring(as.character(year_and_month), 5, 6))
) %>%
#show_query()
#filter(station_id == selected_station & year >= selected_start_year & year <= selected_end_year) %>%
#select(month, year, selected_variable) %>%
collect()
data <- monthly_met_data_table %>%
mutate(
month = sql(CAST(SUBSTR(CAST(`year_and_month` AS CHAR), 1, 4) AS INT) AS `month`)
#month = as.integer(substring(as.character(year_and_month), 1, 4)),
#year = as.numeric(substring(as.character(year_and_month), 5, 6))
) %>%
show_query()
data <- monthly_met_data_table %>%
mutate(
month = sql(CAST(SUBSTR(CAST(`year_and_month` AS CHAR), 1, 4) AS INT))
#month = as.integer(substring(as.character(year_and_month), 1, 4)),
#year = as.numeric(substring(as.character(year_and_month), 5, 6))
) %>%
show_query()
data <- monthly_met_data_table %>%
mutate(
month = as.integer(substring(as.character(year_and_month), 1, 4)),
year = as.numeric(substring(as.character(year_and_month), 5, 6))
) %>%
show_query()
data <- monthly_met_data_table %>%
mutate(
month = as.integer(substring(as.character(year_and_month), 1, 4)),
year = as.numeric(substring(as.character(year_and_month), 5, 6))
) %>%
#show_query()
#filter(station_id == selected_station & year >= selected_start_year & year <= selected_end_year) %>%
#select(month, year, selected_variable) %>%
collect()
data <- monthly_met_data_table %>%
mutate(
month = substring(as.character(year_and_month), 1, 4),
year = substring(as.character(year_and_month), 5, 6)
) %>%
#show_query()
#filter(station_id == selected_station & year >= selected_start_year & year <= selected_end_year) %>%
#select(month, year, selected_variable) %>%
collect()
data <- monthly_met_data_table %>%
mutate(
month = substring(as.character(year_and_month), 1, 4),
year = substring(as.character(year_and_month), 5, 6)
) %>%
show_query()
data <- monthly_met_data_table %>%
mutate(
month = substring(as.character(year_and_month), 1, 4),
year = substring(as.character(year_and_month), 5, 6)
) %>%
mutate(month=as.numeric(month)) %>%
show_query()
data <- monthly_met_data_table %>%
mutate(
month = substring(as.character(year_and_month), 1, 4),
year = substring(as.character(year_and_month), 5, 6)
) %>%
mutate(month=as.numeric(month)) %>%
#show_query()
#filter(station_id == selected_station & year >= selected_start_year & year <= selected_end_year) %>%
#select(month, year, selected_variable) %>%
collect()
data <- monthly_met_data_table %>%
mutate(
month = substring(as.character(year_and_month), 1, 4),
year = substring(as.character(year_and_month), 5, 6)
) %>%
mutate(month=as.numeric(month)) %>%
show_query()
data <- monthly_met_data_table %>%
mutate(
month = substring(as.character(year_and_month), 1, 4),
year = substring(as.character(year_and_month), 5, 6)
) %>%
mutate(month=as.numeric(month)) %>%
select(month, year, selected_variable) %>%
collect()
data <- monthly_met_data_table %>%
mutate(
month = substring(as.character(year_and_month), 1, 4),
year = substring(as.character(year_and_month), 5, 6)
) %>%
select(month, year, selected_variable) %>%
collect()
View(data)
data <- data %>%
mutate(
month = as.numeric(month),
year = as.numeric(month)
)
filter(year >= selected_start_year & year <= selected_end_year)
data <- data %>%
mutate(
month = as.numeric(month),
year = as.numeric(month)
) %>%
filter(year >= selected_start_year & year <= selected_end_year)
data <- monthly_met_data_table %>%
mutate(
month = substring(as.character(year_and_month), 1, 4),
year = substring(as.character(year_and_month), 5, 6)
) %>%
filter(station_id == selected_station) %>%
select(month, year, selected_variable) %>%
collect()
data <- data %>%
mutate(
month = as.numeric(month),
year = as.numeric(year)
) %>%
filter(year >= selected_start_year & year <= selected_end_year)
data <- monthly_met_data_table %>%
mutate(
month = substring(as.character(year_and_month), 1, 4),
year = substring(as.character(year_and_month), 5, 6)
) %>%
filter(station_id == selected_station) %>%
select(month, year, selected_variable) %>%
collect()
data <- monthly_met_data_table %>%
mutate(
year = substring(as.character(year_and_month), 1, 4),
month = substring(as.character(year_and_month), 5, 6)
) %>%
filter(station_id == selected_station) %>%
select(month, year, selected_variable) %>%
collect()
data <- data %>%
mutate(
month = as.numeric(month),
year = as.numeric(year)
) %>%
filter(year >= selected_start_year & year <= selected_end_year)
data <- monthly_met_data_table %>%
mutate(
year = as.numeric(substring(as.character(year_and_month), 1, 4)),
month = substring(as.character(year_and_month), 5, 6)
) %>%
filter(station_id == selected_station) %>%
select(month, year, selected_variable) %>%
collect()
selected_station <- 2
selected_start_year <- 2006
selected_end_year <- 2009
selected_variable <- "max_temperatura_interna"
dotenv::load_dot_env("../../.env")
con <- dbConnect(RMySQL::MySQL(),
dbname = Sys.getenv("DB_DATABASE"),
host = Sys.getenv("DB_HOST"),
port = as.integer(Sys.getenv("DB_PORT")),
user = Sys.getenv("DB_USERNAME"),
password = Sys.getenv("DB_PASSWORD")
)
dbSendQuery(con, "set character set 'utf8mb4'")
stations_table <- tbl(con, "stations") %>%
select(1,3) %>%
collect()
Encoding(stations_table$label) <- "UTF-8"
selected_station_label <- as.character(
stations_table %>%
filter(id==selected_station) %>%
select(2)
)
monthly_met_data_table <- tbl(con, "monthly_met_data")
data <- monthly_met_data_table %>%
mutate(
year = substring(as.character(year_and_month), 1, 4),
month = substring(as.character(year_and_month), 5, 6)
) %>%
filter(station_id == selected_station) %>%
select(month, year, selected_variable) %>%
collect()
data <- data %>%
mutate(
year = as.numeric(year),
month = as.numeric(month)
)
filter(year >= selected_start_year & year <= selected_end_year)
View(data)
data <- monthly_met_data_table %>%
mutate(
year = substring(as.character(year_and_month), 1, 4),
month = substring(as.character(year_and_month), 5, 6)
) %>%
filter(station_id == selected_station) %>%
select(month, year, selected_variable) %>%
collect()
data <- data %>%
mutate(
year = as.numeric(year),
month = as.numeric(month)
) %>%
filter(year >= selected_start_year & year <= selected_end_year)
senamhi_monthly <- data %>%
arrange(month) %>%
complete(month = 1:12) %>%
pivot_wider(names_from = "month", values_from = 3) %>%
rename(
"AÃ‘O" = year, ENE = `1`, FEB = `2`, MAR = `3`, ABR = `4`, MAY = `5`, JUN = `6`,
JUL = `7`, AGO = `8`, SEP = `9`, OCT = `10`, NOV = `11`, DIC = `12`
)
senamhi_details <- paste(selected_station_label, selected_variable)
write.xlsx(senamhi_monthly, "senamhi_monthly.xlsx", sheetname = senamhi_details)
View(senamhi_monthly)
selected_station <- 2
selected_start_year <- 2006
selected_end_year <- 2009
selected_variable <- "max_temperatura_interna"
dotenv::load_dot_env("../../.env")
con <- dbConnect(RMySQL::MySQL(),
dbname = Sys.getenv("DB_DATABASE"),
host = Sys.getenv("DB_HOST"),
port = as.integer(Sys.getenv("DB_PORT")),
user = Sys.getenv("DB_USERNAME"),
password = Sys.getenv("DB_PASSWORD")
)
dbSendQuery(con, "set character set 'utf8mb4'")
stations_table <- tbl(con, "stations") %>%
select(1,3) %>%
collect()
selected_station_label <- as.character(
stations_table %>%
filter(id==selected_station) %>%
select(2)
)
View(stations_table)
Encoding(stations_table$label) <- "UTF-8"
selected_station_label <- as.character(
stations_table %>%
filter(id==selected_station) %>%
select(2)
)
View(stations_table)
monthly_met_data_table <- tbl(con, "monthly_met_data")
data <- monthly_met_data_table %>%
mutate(
year = substring(as.character(year_and_month), 1, 4),
month = substring(as.character(year_and_month), 5, 6)
) %>%
filter(station_id == selected_station) %>%
select(month, year, selected_variable) %>%
collect()
View(data)
data <- data %>%
mutate(
year = as.numeric(year),
month = as.numeric(month)
) %>%
filter(year >= selected_start_year & year <= selected_end_year)
senamhi_monthly <- data %>%
arrange(month) %>%
complete(month = 1:12)
senamhi_monthly <- data %>%
arrange(month) %>%
complete(month = 1:12) %>%
pivot_wider(names_from = "month", values_from = 3)
senamhi_monthly <- data %>%
arrange(month) %>%
complete(month = 1:12) %>%
complete(month= selected_start_year:selected_end_year)
senamhi_monthly <- data %>%
arrange(month) %>%
complete(month = 1:12) %>%
complete(year= selected_start_year:selected_end_year)
senamhi_monthly <- data %>%
arrange(month) %>%
complete(month = 1:12) %>%
complete(year= selected_start_year:selected_end_year) %>%
pivot_wider(names_from = "month", values_from = 3)
senamhi_monthly <- data %>%
arrange(month) %>%
complete(month = 1:12) %>%
complete(year= selected_start_year:selected_end_year) %>%
pivot_wider(names_from = "month", values_from = 3) %>%
filter(!is.na(year)) %>%
rename(
"AÃ‘O" = year, ENE = `1`, FEB = `2`, MAR = `3`, ABR = `4`, MAY = `5`, JUN = `6`,
JUL = `7`, AGO = `8`, SEP = `9`, OCT = `10`, NOV = `11`, DIC = `12`
)
renv::restore()
selected_station <- 2
selected_start_year <- 2006
selected_end_year <- 2006
selected_variable <- "max_temperatura_interna"
selected_station_label <- as.character(
stations_table %>%
filter(id==selected_station) %>%
select(2)
)
monthly_met_data_table <- tbl(con, "monthly_met_data")
data <- monthly_met_data_table %>%
mutate(
year = substring(as.character(year_and_month), 1, 4),
month = substring(as.character(year_and_month), 5, 6)
) %>%
filter(station_id == selected_station) %>%
select(month, year, selected_variable) %>%
collect()
data <- data %>%
mutate(
year = as.numeric(year),
month = as.numeric(month)
) %>%
filter(year >= selected_start_year & year <= selected_end_year)
senamhi_monthly <- data %>%
arrange(month) %>%
complete(month = 1:12) %>%
complete(year = selected_start_year:selected_end_year) %>%
pivot_wider(names_from = "month", values_from = 3) %>%
filter(!is.na(year)) %>%
rename(
"AÃ‘O" = year, ENE = `1`, FEB = `2`, MAR = `3`, ABR = `4`, MAY = `5`, JUN = `6`,
JUL = `7`, AGO = `8`, SEP = `9`, OCT = `10`, NOV = `11`, DIC = `12`
)
View(senamhi_monthly)
install.packages("openxlsx")
renv::restore()
install.packages("openxlsx")
install.packages("dotenv")
install.packages("RMySQL")
install.packages("tidyverse")
renv::restore(confirm = FALSE)
library(dotenv)
library(RMySQL)
library(tidyverse)
library(openxlsx)
